# pgqueryguard

Установка venv:
```bash
pip install uv
make venv
```

---

## CLI:

---

```bash
uv run pgqueryguard check ./path/to/directory
```

(./path/to/directory надо заменить на путь к директории, в которой будет проведет поиск файлов с sql запросами)

Без флагов происходит только проверка на корректность написания sql запросов в файлах *.sql, *.psql, *.pgsql.

Флаги:

- `--fix`
    
    Применяет форматирование к найденным файлам

- `--db-url postgresql://user:pass@localhost:5432/postgres`

    Ссылка для подключения к БД. Если указана, то будет применена оптимизация запроса на основе типов запрашиваемых в sql аргументов.

    (Вместо postgresql://user:pass@localhost:5432/postgres надо указать ссылку для подключения к своей БД, на которую будет сделан запрос)

- `--no-recursive`

    Указывает, что поиск sql файлов не надо производить рекурсивно.

- `--pg-format-file ./path/to/file`

    Для форматирования можно использовать pg_format, для этого надо указать флаг и путь к конфигурации pg_format. Если запуск происходит с Windows, должен быть установлен Perl.

- `--config ./path/to/file`

    Путь к файлу конфигурации для форматирования с pg-format, либо со стандартным форматированием.

    Пример конфига для pg-format:

    ```
    keyword-case=2
    type-case=1
    spaces=2
    no-extra-line=1
    ```

    Пример конфига для стандартного форматирования:

    ```
    identify=true
    normalize=true
    normalize_functions=true
    leading_comma=true
    comments=true
    pad = 2
    indent = 2
    max_text_width = 80
    ```

---

```bash
uv run pgqueryguard report ./path/to/directory
```

(./path/to/directory надо заменить на путь к директории, в которой будет проведет поиск файлов с sql запросами)

Без флагов происходит только проверка на корректность написания sql запросов в файлах *.sql, *.psql, *.pgsql.

Данная команда позваоляет сформирвать отчет в формате html, в котором будут указаны приблизитьельные затраты по времени и ресурсам на основе применения EXPLAIN к запросу, а также рекомендации по улучшению запроса или указание на проблемы.

Для запуска также нужен флаг `--db-url` с ссылкой на подключение к БД.
